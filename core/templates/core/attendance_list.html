{% extends "base.html" %} {% block title %}Kelola Absensi{% endblock %} {% block page_title %}Kelola Absensi{% endblock %} {% block content %}
<div class="mb-6">
	<form method="GET" action="{% url 'attendance_list' %}" class="flex items-center gap-4">
		<div class="relative max-w-sm">
			<input
				type="date"
				name="filter_date"
				value="{{ selected_date|date:'Y-m-d' }}"
				max="{{ max_date }}"
				class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" />
		</div>
		<button type="submit" class="p-2.5 text-sm font-medium text-white bg-orange-500 rounded-lg border border-orange-600 hover:bg-orange-600 focus:ring-4 focus:outline-none focus:ring-orange-300">
			<svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
				<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
			</svg>
			<span class="sr-only">Cari</span>
		</button>
	</form>
</div>

<div class="bg-white/70 backdrop-blur-sm shadow-lg rounded-lg overflow-hidden border border-white/30">
	<div class="overflow-x-auto horizontal-scrollbar">
		<table class="w-full text-sm text-left rtl:text-right text-gray-500">
			<thead class="text-xs text-gray-700 uppercase bg-gray-50/50">
				<tr>
					<th class="px-6 py-3">Nama Lengkap</th>
					<th class="px-6 py-3">Jabatan</th>
					<th class="px-6 py-3 text-center">Waktu Absen</th>
					<th class="px-6 py-3 text-center">Status</th>
					<th class="px-6 py-3 text-center">Gambar</th>
					<th class="px-6 py-3 text-center">APD</th>
					<th class="px-6 py-3 text-center">Suhu</th>
					<th class="px-6 py-3 text-center">Aksi</th>
				</tr>
			</thead>
			<tbody>
				{% for data in attendance_data %}
				<tr class="bg-white border-b hover:bg-gray-50/50">
					<td data-label="Nama" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ data.employee.full_name }}</td>
					<td data-label="Jabatan" class="px-6 py-4">{{ data.employee.role|default:"-" }}</td>

					{% with record=data.attendance %} {% if record %}
					<td class="px-6 py-3 text-center" data-label="Waktu Absen">{{ record.check_in_time|date:"H:i:s" }}</td>
					<td class="px-6 py-3 text-center" data-label="Status">
						<span
							class="text-xs font-medium me-2 px-2.5 py-0.5 rounded {% if record.status == 'Hadir' %} bg-green-100 text-green-800 {% elif record.status == 'Sakit' %} bg-yellow-100 text-yellow-800 {% elif record.status == 'Izin' %} bg-blue-100 text-blue-800 {% else %} bg-red-100 text-red-800 {% endif %}">
							{{ record.get_status_display }}
						</span>
					</td>
					<td class="px-6 py-3 text-center" data-label="Gambar">
						{% if record.image_attendance %}
						<button data-modal-target="image-modal" data-modal-toggle="image-modal" data-image-url="{{ record.image_attendance.url }}" class="text-blue-600 hover:underline">Lihat</button>
						{% else %} - {% endif %}
					</td>
					<td class="px-6 py-3 text-center" data-label="APD">
						{% for ppe in record.detected_ppes.all %}
						<span class="bg-gray-200 text-gray-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded">{{ ppe.name }}</span>
						{% empty %} - {% endfor %}
					</td>
					<td class="px-6 py-3 text-center" data-label="Suhu">
						{% if record.body_temperature %} {% if record.body_temperature > 37.5 %}
						<span class="text-red-600 font-bold">{{ record.body_temperature }} °C</span>
						{% else %} {{ record.body_temperature }} °C {% endif %} {% else %} - {% endif %}
					</td>
					<td class="px-6 py-4 text-center" data-label="Aksi">
						<a
							href="{% url 'attendance_edit' record.pk %}"
							class="inline-flex items-center p-2 text-sm font-medium text-center text-white bg-yellow-400 rounded-lg hover:bg-yellow-500 focus:ring-4 focus:outline-none focus:ring-yellow-300"
							title="Edit Absensi">
							<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
								<path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
								<path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
							</svg>
						</a>
					</td>
					{% else %}
					<td colspan="5" class="text-center justify-center text-gray-400 italic">Belum Absen</td>
					<td data-label="Aksi" class="px-6 py-4 text-center">
						<a
							href="{% url 'attendance_record' data.employee.pk %}?date={{ selected_date|date:'Y-m-d' }}"
							class="inline-flex items-center p-2 text-sm font-medium text-center text-white bg-blue-600 rounded-lg hover:bg-blue-700"
							title="Catat Kehadiran">
							<svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 18">
								<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 1v16M1 9h16" />
							</svg>
						</a>
					</td>
					{% endif %} {% endwith %}
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>

<div id="image-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
	<div class="relative p-4 w-full max-w-lg max-h-full">
		<div class="relative bg-white rounded-lg shadow">
			<div class="flex items-center justify-between p-4 border-b rounded-t">
				<h3 class="text-xl font-semibold text-gray-900">Gambar Absensi</h3>
				<button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-hide="image-modal">
					<svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
						<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
					</svg>
					<span class="sr-only">Close modal</span>
				</button>
			</div>
			<div class="p-4 flex justify-center items-center">
				<img id="modal-image" src="" alt="Gambar Absensi" class="max-w-full max-h-[70vh] rounded-lg" />
			</div>
		</div>
	</div>
</div>

<style>
	@media (max-width: 767px) {
		thead {
			display: none;
		}
		tr {
			display: block;
			margin-bottom: 1.5rem;
			border-bottom: 2px solid #e2e8f0;
			padding-bottom: 1rem;
		}
		td {
			display: flex;
			justify-content: space-between;
			align-items: center;
			text-align: right;
			padding: 0.75rem 0.5rem;
			border-bottom: 1px solid #edf2f7;
		}
		td:last-child {
			border-bottom: 0;
		}
		td::before {
			content: attr(data-label);
			text-align: left;
			font-weight: bold;
			color: #4a5568;
		}
		td[data-label="Aksi"] {
			justify-content: center;
		}
		td[data-label="Aksi"]::before {
			content: "";
		}
	}
	.horizontal-scrollbar {
		-ms-overflow-style: none;
		scrollbar-width: none;
	}
	.horizontal-scrollbar::-webkit-scrollbar {
		display: none;
	}
</style>
<script>
	document.addEventListener("DOMContentLoaded", () => {
		const modalImage = document.getElementById("modal-image");
		document.querySelectorAll('[data-modal-toggle="image-modal"]').forEach((button) => {
			button.addEventListener("click", () => {
				const imageUrl = button.getAttribute("data-image-url");
				modalImage.setAttribute("src", imageUrl);
			});
		});
	});
</script>
{% endblock %}
